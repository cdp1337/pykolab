#!/bin/bash

echo "Updating language files"

> po/POTFILES.in
> po/POTFILES.skip

find . -type f -name "*.py" -o -name "*.py.in" | \
    sort | \
    sed -e 's/^.\///g' | \
    while read file; do
        if [ $(git ls-files --error-unmatch "${file}" >/dev/null 2>&1; echo $?) -eq 0 ]; then
            echo "${file}" >> po/POTFILES.in
        else
            echo "${file}" >> po/POTFILES.skip
        fi
    done

cd po/
intltool-update --pot --gettext-package=pykolab
if [ "$1" == "po" ]; then
    for lang_file in `ls -1 *.po`; do
        lang=$(echo ${lang_file} | cut -f1 -d'.')
        intltool-update -d ${lang}
        msginit --no-translator --locale=${lang} --input=pykolab.pot --output=${lang_file}
        msgmerge -U ${lang_file} pykolab.pot
    done
    
fi
cd ..
