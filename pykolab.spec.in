%{!?python_sitelib: %define python_sitelib %(python -c "from distutils.sysconfig import get_python_lib; print get_python_lib()")}

Summary:        Kolab Groupware Solution
Name:           pykolab
Version:        @VERSION@
Release:        @RELEASE@%{?dist}
License:        GPLv3+
Group:          Applications/System
URL:            http://kolab.org/
Source0:        http://files.kolab.org/releases/%{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root
BuildArch:      noarch

%description
Kolab enables you to easily build a groupware server as part of a
collaborative environment.

##
## Kolab CLI
##
%package -n kolab-cli
Summary:        Kolab CLI components
Group:          Applications/System
BuildRequires:  intltool, gettext, python

%description -n kolab-cli
Kolab CLI utilities

##
## Kolab SASL Authentication Daemon
##
%package -n kolab-saslauthd
Summary:        Kolab SASL Authentication Daemon
Group:          Applications/System
BuildRequires:  intltool, gettext, python
Requires:       pykolab = %{version}-%{release}

%description -n kolab-saslauthd
Kolab SASL Authentication Daemon for multi-domain, multi-authn database deployments

##
## Kolab SMTP Access Policy for Postfix
##
%package -n postfix-kolab
Summary:        Kolab SMTP Access Policy for Postfix
Group:          Applications/System
BuildRequires:  intltool, gettext, python
Requires:       postfix
Requires:       pykolab = %{version}-%{release}

%description -n postfix-kolab
Kolab SMTP Access Policy for Postfix

%prep
%setup -q

%build
%configure

%install
rm -rf %{buildroot}
make install DESTDIR=%{buildroot}

%find_lang pykolab

%clean
rm -rf %{buildroot}

%files -f pykolab.lang
%defattr(-,root,root,-)
%doc AUTHORS ChangeLog COPYING README README.tests
%{_bindir}/*
%{_sbindir}/kolab
%{_sbindir}/kolab-conf
%{_sbindir}/kolabd
%config(noreplace) %{_sysconfdir}/kolab/kolab.conf
%{_datadir}/pykolab/

%files -n kolab-saslauthd
%defattr(-,root,root,-)
%doc AUTHORS ChangeLog COPYING
%{_sbindir}/kolab-saslauthd

%files -n postfix-kolab
%defattr(-,root,root,-)
%doc AUTHORS ChangeLog COPYING
%{_libexecdir}/postfix/kolab_smtp_access_policy

%changelog
* @DATESTAMP@ Jeroen van Meeuwen (Kolab Systems) <vanmeeuwen@kolabsys.com> @VERSION@-@RELEASE@
- Initial package of new upstream version

